{"ast":null,"code":"import useSWR, { mutate } from \"swr\";\nimport { useRouter } from \"next/router\";\nimport formidable from \"formidable\";\nimport fs from \"fs\";\nimport { hasuraAdminClient, gql } from \"../../lib/hasura-admin-client\";\nimport { hasuraUserClient } from \"../../lib/hasura-user-client\";\nexport default function test({}) {\n  const config = {\n    api: {\n      bodyParser: false\n    }\n  };\n  const GetUsers = gql`\n    query MyQuery {\n      User {\n        id\n        Name\n        email\n      }\n    }\n  `;\n\n  const post = async (req, res) => {\n    const form = new formidable.IncomingForm();\n    form.parse(req, async function (err, fields, files) {\n      await saveFile(files.file);\n      return res.status(201).send(\"\");\n    });\n  };\n\n  const saveFile = async file => {\n    const id = 22;\n    const hasura = hasuraUserClient();\n    const data = fs.readFileSync(file.path);\n    fs.writeFileSync(`./public/${file.name}`, data);\n    await fs.unlinkSync(file.path);\n    const Avatar = file.name;\n    const UploadImage = gql`\n      mutation MyMutation($Avatar: String!, $id: Int!) {\n        update_User_by_pk(pk_columns: { id: $id }, _set: { Avatar: $Avatar }) {\n          Avatar\n          Name\n        }\n      }\n    `;\n\n    try {\n      await hasura.request(UploadImage, {\n        id,\n        Avatar\n      });\n      mutate();\n    } catch (error) {\n      console.error(error);\n    }\n\n    return;\n  };\n}","map":{"version":3,"sources":["C:/Users/msdtt/OneDrive/Documents/amai_hr_next_js_hasura/amai-hr/pages/api/file.js"],"names":["useSWR","mutate","useRouter","formidable","fs","hasuraAdminClient","gql","hasuraUserClient","test","config","api","bodyParser","GetUsers","post","req","res","form","IncomingForm","parse","err","fields","files","saveFile","file","status","send","id","hasura","data","readFileSync","path","writeFileSync","name","unlinkSync","Avatar","UploadImage","request","error","console"],"mappings":"AAAA,OAAOA,MAAP,IAAiBC,MAAjB,QAA+B,KAA/B;AACA,SAASC,SAAT,QAA0B,aAA1B;AAEA,OAAOC,UAAP,MAAuB,YAAvB;AACA,OAAOC,EAAP,MAAe,IAAf;AACA,SAASC,iBAAT,EAA4BC,GAA5B,QAAuC,+BAAvC;AACA,SAASC,gBAAT,QAAiC,8BAAjC;AACA,eAAe,SAASC,IAAT,CAAc,EAAd,EAAkB;AAC/B,QAAMC,MAAM,GAAG;AACbC,IAAAA,GAAG,EAAE;AACHC,MAAAA,UAAU,EAAE;AADT;AADQ,GAAf;AAMA,QAAMC,QAAQ,GAAGN,GAAI;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GARE;;AAUA,QAAMO,IAAI,GAAG,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AAC/B,UAAMC,IAAI,GAAG,IAAIb,UAAU,CAACc,YAAf,EAAb;AACAD,IAAAA,IAAI,CAACE,KAAL,CAAWJ,GAAX,EAAgB,gBAAgBK,GAAhB,EAAqBC,MAArB,EAA6BC,KAA7B,EAAoC;AAClD,YAAMC,QAAQ,CAACD,KAAK,CAACE,IAAP,CAAd;AACA,aAAOR,GAAG,CAACS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAArB,CAAP;AACD,KAHD;AAID,GAND;;AAQA,QAAMH,QAAQ,GAAG,MAAOC,IAAP,IAAgB;AAC/B,UAAMG,EAAE,GAAG,EAAX;AACA,UAAMC,MAAM,GAAGpB,gBAAgB,EAA/B;AACA,UAAMqB,IAAI,GAAGxB,EAAE,CAACyB,YAAH,CAAgBN,IAAI,CAACO,IAArB,CAAb;AACA1B,IAAAA,EAAE,CAAC2B,aAAH,CAAkB,YAAWR,IAAI,CAACS,IAAK,EAAvC,EAA0CJ,IAA1C;AACA,UAAMxB,EAAE,CAAC6B,UAAH,CAAcV,IAAI,CAACO,IAAnB,CAAN;AACA,UAAMI,MAAM,GAAGX,IAAI,CAACS,IAApB;AAEA,UAAMG,WAAW,GAAG7B,GAAI;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA,KAPI;;AAQA,QAAI;AACF,YAAMqB,MAAM,CAACS,OAAP,CAAeD,WAAf,EAA4B;AAAET,QAAAA,EAAF;AAAMQ,QAAAA;AAAN,OAA5B,CAAN;AACAjC,MAAAA,MAAM;AACP,KAHD,CAGE,OAAOoC,KAAP,EAAc;AACdC,MAAAA,OAAO,CAACD,KAAR,CAAcA,KAAd;AACD;;AACD;AACD,GAvBD;AAwBD","sourcesContent":["import useSWR, { mutate } from \"swr\";\r\nimport { useRouter } from \"next/router\";\r\n\r\nimport formidable from \"formidable\";\r\nimport fs from \"fs\";\r\nimport { hasuraAdminClient, gql } from \"../../lib/hasura-admin-client\";\r\nimport { hasuraUserClient } from \"../../lib/hasura-user-client\";\r\nexport default function test({}) {\r\n  const config = {\r\n    api: {\r\n      bodyParser: false,\r\n    },\r\n  };\r\n\r\n  const GetUsers = gql`\r\n    query MyQuery {\r\n      User {\r\n        id\r\n        Name\r\n        email\r\n      }\r\n    }\r\n  `;\r\n\r\n  const post = async (req, res) => {\r\n    const form = new formidable.IncomingForm();\r\n    form.parse(req, async function (err, fields, files) {\r\n      await saveFile(files.file);\r\n      return res.status(201).send(\"\");\r\n    });\r\n  };\r\n\r\n  const saveFile = async (file) => {\r\n    const id = 22;\r\n    const hasura = hasuraUserClient();\r\n    const data = fs.readFileSync(file.path);\r\n    fs.writeFileSync(`./public/${file.name}`, data);\r\n    await fs.unlinkSync(file.path);\r\n    const Avatar = file.name;\r\n\r\n    const UploadImage = gql`\r\n      mutation MyMutation($Avatar: String!, $id: Int!) {\r\n        update_User_by_pk(pk_columns: { id: $id }, _set: { Avatar: $Avatar }) {\r\n          Avatar\r\n          Name\r\n        }\r\n      }\r\n    `;\r\n    try {\r\n      await hasura.request(UploadImage, { id, Avatar });\r\n      mutate();\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n    return;\r\n  };\r\n}\r\n"]},"metadata":{},"sourceType":"module"}