{"ast":null,"code":"import _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\msdtt\\\\OneDrive\\\\Documents\\\\amai_hr_next_js_hasura\\\\amai-hr\\\\context\\\\auth.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$(),\n    _s3 = $RefreshSig$();\n\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { createContext, useReducer, useContext, useEffect } from \"react\";\nimport createPersistedState from \"use-persisted-state\";\nvar AuthDispatchContext = /*#__PURE__*/createContext();\nvar AuthStateContext = /*#__PURE__*/createContext();\nvar usePersistedAuthState = createPersistedState(\"AMAI_AUTH\");\nvar LOGIN_SUCCESS = \"LOGIN_SUCCESS\";\nvar UPDATE_USER = \"UPDATE_USER\";\nvar LOGOUT = \"LOGOUT\";\nvar initialState = {\n  isAuthenticated: false,\n  user: null,\n  token: null,\n  save_last_seen: false\n};\nexport var getServerSideProps = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(context) {\n    var session;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return getSession(context);\n\n          case 2:\n            session = _context.sent;\n\n            if (!(context.res && !session)) {\n              _context.next = 5;\n              break;\n            }\n\n            return _context.abrupt(\"return\", {\n              redirect: {\n                permanent: false,\n                destination: \"/login\"\n              }\n            });\n\n          case 5:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function getServerSideProps(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nfunction reducer(state, _ref2) {\n  var payload = _ref2.payload,\n      type = _ref2.type;\n\n  switch (type) {\n    case LOGIN_SUCCESS:\n      return _objectSpread(_objectSpread(_objectSpread({}, state), payload), {}, {\n        isAuthenticated: true\n      });\n\n    case UPDATE_USER:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        user: _objectSpread(_objectSpread({}, state.user), payload)\n      });\n\n    case LOGOUT:\n      return initialState;\n\n    default:\n      throw new Error(\"Unhandled action type \".concat(type));\n  }\n}\n\nfunction AuthProvider(_ref3) {\n  _s();\n\n  var children = _ref3.children;\n\n  var _usePersistedAuthStat = usePersistedAuthState(initialState),\n      _usePersistedAuthStat2 = _slicedToArray(_usePersistedAuthStat, 2),\n      savedAuthState = _usePersistedAuthStat2[0],\n      saveAuthState = _usePersistedAuthStat2[1];\n\n  var _useReducer = useReducer(reducer, savedAuthState),\n      state = _useReducer[0],\n      dispatch = _useReducer[1];\n\n  useEffect(function () {\n    saveAuthState(state);\n  }, [state, saveAuthState]);\n\n  var login = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_ref4) {\n      var email, password, save_last_seen, res, json, token, user;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              email = _ref4.email, password = _ref4.password, save_last_seen = _ref4.save_last_seen;\n              _context2.next = 3;\n              return fetch(\"/api/login\", {\n                method: \"POST\",\n                body: JSON.stringify({\n                  email: email,\n                  password: password\n                }),\n                headers: {\n                  \"Content-Type\": \"application/json\"\n                }\n              });\n\n            case 3:\n              res = _context2.sent;\n              _context2.next = 6;\n              return res.json();\n\n            case 6:\n              json = _context2.sent;\n\n              if (res.ok) {\n                _context2.next = 9;\n                break;\n              }\n\n              throw new Error(json === null || json === void 0 ? void 0 : json.message);\n\n            case 9:\n              token = json.token, user = _objectWithoutProperties(json, [\"token\"]);\n              dispatch({\n                type: LOGIN_SUCCESS,\n                payload: {\n                  token: token,\n                  user: user,\n                  save_last_seen: save_last_seen\n                }\n              });\n\n            case 11:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function login(_x2) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  var register = /*#__PURE__*/function () {\n    var _ref7 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(_ref6) {\n      var name, last_name, email, domain, phone_number, password, created_at, res;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              name = _ref6.name, last_name = _ref6.last_name, email = _ref6.email, domain = _ref6.domain, phone_number = _ref6.phone_number, password = _ref6.password, created_at = _ref6.created_at;\n              _context3.next = 3;\n              return fetch(\"/api/register\", {\n                method: \"POST\",\n                body: JSON.stringify({\n                  name: name,\n                  last_name: last_name,\n                  email: email,\n                  domain: domain,\n                  phone_number: phone_number,\n                  password: password,\n                  created_at: created_at\n                }),\n                headers: {\n                  \"Content-Type\": \"application/json\"\n                }\n              });\n\n            case 3:\n              res = _context3.sent;\n\n            case 4:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function register(_x3) {\n      return _ref7.apply(this, arguments);\n    };\n  }();\n\n  var updateUser = function updateUser(payload) {\n    return dispatch({\n      type: UPDATE_USER,\n      payload: payload\n    });\n  };\n\n  var logout = function logout() {\n    return dispatch({\n      type: LOGOUT\n    });\n  };\n\n  return __jsx(AuthDispatchContext.Provider, {\n    value: {\n      login: login,\n      register: register,\n      updateUser: updateUser,\n      logout: logout\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 5\n    }\n  }, __jsx(AuthStateContext.Provider, {\n    value: state,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 7\n    }\n  }, children));\n}\n\n_s(AuthProvider, \"lKzQeW+Jbto5/76m6Wn/+NygBxw=\", false, function () {\n  return [usePersistedAuthState];\n});\n\n_c = AuthProvider;\n\nfunction useAuthDispatch() {\n  _s2();\n\n  var context = useContext(AuthDispatchContext);\n  if (context === undefined) throw new Error(\"useAuthDispatch must be used within an AuthProvider\");\n  return context;\n}\n\n_s2(useAuthDispatch, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\n\nfunction useAuthState() {\n  _s3();\n\n  var context = useContext(AuthStateContext);\n  if (context === undefined) throw new Error(\"useAuthState must be used within an AuthProvider\");\n  return context;\n}\n\n_s3(useAuthState, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\n\nexport { AuthProvider, useAuthDispatch, useAuthState };\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"sources":["C:/Users/msdtt/OneDrive/Documents/amai_hr_next_js_hasura/amai-hr/context/auth.js"],"names":["createContext","useReducer","useContext","useEffect","createPersistedState","AuthDispatchContext","AuthStateContext","usePersistedAuthState","LOGIN_SUCCESS","UPDATE_USER","LOGOUT","initialState","isAuthenticated","user","token","save_last_seen","getServerSideProps","context","getSession","session","res","redirect","permanent","destination","reducer","state","payload","type","Error","AuthProvider","children","savedAuthState","saveAuthState","dispatch","login","email","password","fetch","method","body","JSON","stringify","headers","json","ok","message","register","name","last_name","domain","phone_number","created_at","updateUser","logout","useAuthDispatch","undefined","useAuthState"],"mappings":"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","sourcesContent":["import { createContext, useReducer, useContext, useEffect } from \"react\";\nimport createPersistedState from \"use-persisted-state\";\n\nconst AuthDispatchContext = createContext();\nconst AuthStateContext = createContext();\n\nconst usePersistedAuthState = createPersistedState(\"AMAI_AUTH\");\n\nconst LOGIN_SUCCESS = \"LOGIN_SUCCESS\";\nconst UPDATE_USER = \"UPDATE_USER\";\nconst LOGOUT = \"LOGOUT\";\n\nconst initialState = {\n  isAuthenticated: false,\n  user: null,\n  token: null,\n  save_last_seen: false,\n};\nexport const getServerSideProps = async (context) => {\n  const session = await getSession(context);\n  if (context.res && !session) {\n    return {\n      redirect: {\n        permanent: false,\n        destination: \"/login\",\n      },\n    };\n  }\n};\nfunction reducer(state, { payload, type }) {\n  switch (type) {\n    case LOGIN_SUCCESS:\n      return {\n        ...state,\n        ...payload,\n        isAuthenticated: true,\n      };\n    case UPDATE_USER:\n      return {\n        ...state,\n        user: {\n          ...state.user,\n          ...payload,\n        },\n      };\n    case LOGOUT:\n      return initialState;\n    default:\n      throw new Error(`Unhandled action type ${type}`);\n  }\n}\n\nfunction AuthProvider({ children }) {\n  const [savedAuthState, saveAuthState] = usePersistedAuthState(initialState);\n  const [state, dispatch] = useReducer(reducer, savedAuthState);\n\n  useEffect(() => {\n    saveAuthState(state);\n  }, [state, saveAuthState]);\n\n  const login = async ({ email, password, save_last_seen }) => {\n    const res = await fetch(\"/api/login\", {\n      method: \"POST\",\n      body: JSON.stringify({ email, password }),\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n    });\n\n    const json = await res.json();\n\n    if (!res.ok) throw new Error(json?.message);\n\n    const { token, ...user } = json;\n\n    dispatch({ type: LOGIN_SUCCESS, payload: { token, user, save_last_seen } });\n  };\n\n  const register = async ({\n    name,\n    last_name,\n    email,\n    domain,\n    phone_number,\n    password,\n    created_at,\n  }) => {\n    const res = await fetch(\"/api/register\", {\n      method: \"POST\",\n      body: JSON.stringify({\n        name,\n        last_name,\n        email,\n        domain,\n        phone_number,\n        password,\n        created_at,\n      }),\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n    });\n\n    // const json = await res.json();\n\n    // if (!res.ok) throw new Error(json?.message);\n\n    // const { token, ...user } = json;\n\n    // dispatch({ type: LOGIN_SUCCESS, payload: { token, user, save_last_seen } });\n  };\n\n  const updateUser = (payload) => dispatch({ type: UPDATE_USER, payload });\n\n  const logout = () => dispatch({ type: LOGOUT });\n\n  return (\n    <AuthDispatchContext.Provider\n      value={{ login, register, updateUser, logout }}\n    >\n      <AuthStateContext.Provider value={state}>\n        {children}\n      </AuthStateContext.Provider>\n    </AuthDispatchContext.Provider>\n  );\n}\n\nfunction useAuthDispatch() {\n  const context = useContext(AuthDispatchContext);\n\n  if (context === undefined)\n    throw new Error(\"useAuthDispatch must be used within an AuthProvider\");\n\n  return context;\n}\n\nfunction useAuthState() {\n  const context = useContext(AuthStateContext);\n\n  if (context === undefined)\n    throw new Error(\"useAuthState must be used within an AuthProvider\");\n\n  return context;\n}\n\nexport { AuthProvider, useAuthDispatch, useAuthState };\n"]},"metadata":{},"sourceType":"module"}